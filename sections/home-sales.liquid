<section class="max-w-6xl mx-auto px-4 py-12 md:px-8">
  <div class="text-center mb-8">
    <h2 class="text-lg md:text-xl font-serif text-gray-800 tracking-widest mb-4">
      {{ section.settings.title }}
    </h2>

    {% if section.settings.description != blank %}
      <div class="text-gray-600 text-sm md:text-base max-w-2xl mx-auto whitespace-pre-wrap leading-relaxed">
        {{ section.settings.description }}
      </div>
    {% endif %}
  </div>

  <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-8">
    {% assign sale_collection = collections[section.settings.collection] %}

    {% for product in sale_collection.products limit: 4 %}
      <a href="{{ product.url }}" class="block group">
        <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden mb-3 relative">
          {% comment %} 画像があるかチェックする if 文を追加したよ [cite: 2026-01-06] {% endcomment %}
          {% if product.featured_image != blank %}
            <img
              src="{{ product.featured_image | image_url: width: 600 }}"
              alt="{{ product.title | escape }}"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              loading="lazy"
            >
          {% else %}
            {% comment %} 画像がない場合はプレースホルダーを表示 [cite: 2026-01-06] {% endcomment %}
            <div class="w-full h-full bg-gray-100 flex items-center justify-center group-hover:scale-105 transition-transform duration-300">
              {{ 'product-1' | placeholder_svg_tag: 'w-full h-full object-cover opacity-40' }}
            </div>
          {% endif %}

          {% if product.compare_at_price > product.price %}
            <div class="absolute top-2 left-2 bg-red-500 text-white text-[9px] md:text-[10px] font-bold px-1.5 py-0.5 rounded shadow-sm">
              SALE
            </div>
          {% endif %}
        </div>

        <h4 class="text-[11px] md:text-sm font-medium text-gray-900 leading-tight mb-1 line-clamp-2 min-h-[2.5em]">
          {{ product.title }}
        </h4>

        <div class="flex items-center gap-2">
          <p class="text-[11px] md:text-sm text-red-600 font-bold">
            {{ product.price | money }}
          </p>
          {% if product.compare_at_price > product.price %}
            <p class="text-[9px] md:text-[11px] text-gray-400 line-through">
              {{ product.compare_at_price | money }}
            </p>
          {% endif %}
        </div>
      </a>
    {% else %}
      {% if request.design_mode %}
        <div class="col-span-full aspect-[2/1] md:aspect-[4/1] bg-gray-50 border-2 border-dashed border-gray-200 rounded-2xl flex items-center justify-center">
          <p class="text-gray-400 text-xs md:text-sm">
            Saleコレクションを選択すると、ここに最大4つの商品が自動で表示されます
          </p>
        </div>
      {% endif %}
    {% endfor %}
  </div>

  <div class="mt-10 text-center">
    <a
      href="{{ sale_collection.url | default: '#' }}"
      class="text-xs md:text-sm text-gray-500 underline underline-offset-4 hover:text-black transition-colors"
    >
      {{ section.settings.link_text }}
    </a>
  </div>
</section>

{% schema %}
{
  "name": "セール品",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "セクション見出し",
      "default": "Sale"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "説明文（テキストエリア）",
      "default": "今だけの特別価格アイテムをチェック。"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "表示するコレクション（Sale）"
    },
    {
      "type": "text",
      "id": "link_text",
      "label": "リンクの文言",
      "default": "Sale中の商品をもっと見る"
    }
  ],
  "presets": [
    {
      "name": "セール品"
    }
  ]
}
{% endschema %}
