{% comment %}
  Main Cart Section
  ã‚«ãƒ¼ãƒˆå°‚ç”¨ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³
{% endcomment %}

{% assign cart_count = 0 %}
{% for item in cart.items %}
  {% unless item.product.handle == 'gift-wrapping' %}
    {% assign cart_count = cart_count | plus: item.quantity %}
  {% endunless %}
{% endfor %}

<div class="max-w-6xl mx-auto px-4 md:px-8 py-8 md:py-12">
  {% if cart.item_count > 0 %}
    {%- comment -%} ã‚«ãƒ¼ãƒˆã«å•†å“ãŒã‚ã‚‹å ´åˆ {%- endcomment -%}

    <h1 class="text-2xl md:text-3xl font-light text-stone-800 mb-6 md:mb-8">
      {{ section.settings.cart_title }}
      {% comment %} <span class="text-stone-500">({{ cart.item_count }}ç‚¹)</span> {% endcomment %}
      <span class="text-stone-500">({{ cart_count }}ç‚¹)</span>
    </h1>

    <form action="{{ routes.cart_url }}" method="post" id="cart-form">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        {%- comment -%} å·¦å´: ã‚«ãƒ¼ãƒˆå•†å“ãƒªã‚¹ãƒˆ {%- endcomment -%}
        <div class="lg:col-span-2">
          <div class="space-y-4">
            {% for item in cart.items %}
              <div class="bg-white border border-stone-200 rounded-lg p-4 md:p-6" data-cart-item="{{ item.key }}">
                <div class="flex gap-4">
                  {%- comment -%} å•†å“ç”»åƒ {%- endcomment -%}
                  <div class="flex-shrink-0 w-24 h-24 md:w-32 md:h-32">
                    {% if item.image %}
                      <img
                        src="{{ item.image | image_url: width: 200 }}"
                        alt="{{ item.product.title }}"
                        class="w-full h-full object-cover rounded"
                        loading="lazy"
                      >
                    {% else %}
                      <div class="w-full h-full bg-stone-100 rounded flex items-center justify-center">
                        <span class="text-stone-400 text-sm">No image</span>
                      </div>
                    {% endif %}
                  </div>

                  {%- comment -%} å•†å“æƒ…å ± {%- endcomment -%}
                  <div class="flex-1 min-w-0">
                    <div class="flex justify-between items-start mb-2">
                      <div class="flex-1 pr-4">
                        <h3 class="text-base md:text-lg font-medium text-stone-800 mb-1">
                          <a href="{{ item.url }}" class="hover:text-stone-600">
                            {{ item.product.title }}
                          </a>
                        </h3>

                        {%- comment -%} ãƒãƒªã‚¢ãƒ³ãƒˆæƒ…å ± {%- endcomment -%}
                        {% unless item.variant.title == 'Default Title' %}
                          <p class="text-sm text-stone-600">
                            {{ item.variant.title }}
                          </p>
                        {% endunless %}

                        {%- comment -%} ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚° {%- endcomment -%}
                        {% if item.properties['ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°'] %}
                          <p class="text-sm text-stone-600 mt-1">ğŸ ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°</p>
                        {% endif %}

                        {%- comment -%} ã‚®ãƒ•ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ {%- endcomment -%}
                        {% if item.properties['ã‚®ãƒ•ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'] %}
                          <p class="text-sm text-stone-600 mt-1">
                            ğŸ’Œ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: {{ item.properties['ã‚®ãƒ•ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'] }}
                          </p>
                        {% endif %}
                      </div>

                      {%- comment -%} ä¾¡æ ¼ï¼ˆPCï¼‰ {%- endcomment -%}
                      <div class="hidden md:block text-right">
                        <p class="text-lg font-medium text-stone-800">
                          {{ item.final_line_price | money }}
                        </p>
                        {% if item.original_line_price > item.final_line_price %}
                          <p class="text-sm text-stone-500 line-through">
                            {{ item.original_line_price | money }}
                          </p>
                        {% endif %}
                      </div>
                    </div>
                    {%- comment -%} æ•°é‡å¤‰æ›´ã¨å‰Šé™¤ {%- endcomment -%}
                    <div class="flex items-center justify-between mt-4">
                      <div class="flex items-center gap-3">
                        {%- comment -%} ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ä»¥å¤–ã®å ´åˆã®ã¿ã€æ•°é‡å¤‰æ›´ã‚’è¡¨ç¤º {%- endcomment -%}
                        {% unless item.product.handle == 'gift-wrapping' %}
                          <div class="flex items-center border border-stone-300 rounded">
                            <button
                              type="button"
                              class="px-3 py-2 hover:bg-stone-50 transition-colors"
                              onclick="updateQuantity('{{ item.key }}', {{ item.quantity | minus: 1 }})"
                              {% if item.quantity <= 1 %}
                                disabled
                              {% endif %}
                            >
                              <span class="text-stone-600">âˆ’</span>
                            </button>

                            <input
                              type="number"
                              name="updates[]"
                              id="updates_{{ item.key }}"
                              value="{{ item.quantity }}"
                              min="0"
                              class="w-12 text-center border-x border-stone-300 py-2 focus:outline-none"
                              data-cart-item-key="{{ item.key }}"
                              onchange="updateQuantity('{{ item.key }}', this.value)"
                            >

                            <button
                              type="button"
                              class="px-3 py-2 hover:bg-stone-50 transition-colors"
                              onclick="updateQuantity('{{ item.key }}', {{ item.quantity | plus: 1 }})"
                            >
                              <span class="text-stone-600">+</span>
                            </button>
                          </div>
                        {% endunless %}

                        {%- comment -%} å‰Šé™¤ãƒœã‚¿ãƒ³ï¼šã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ã®å ´åˆã¯æ•°é‡ãŒãªã„ã®ã§ã€è‡ªå‹•çš„ã«å·¦ã«å¯„ã‚‹ã‚ˆ {%- endcomment -%}
                        <button
                          type="button"
                          class="text-sm text-stone-500 hover:text-red-600 transition-colors"
                          onclick="updateQuantity('{{ item.key }}', 0)"
                        >
                          å‰Šé™¤
                        </button>
                      </div>

                      {%- comment -%} ä¾¡æ ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ {%- endcomment -%}
                      <div class="md:hidden text-right">
                        <p class="text-base font-medium text-stone-800">
                          {{ item.final_line_price | money }}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>

        {%- comment -%} å³å´: å•†å“è¦ç´„ãƒªã‚¹ãƒˆ {%- endcomment -%}
        <div class="lg:col-span-1">
          <div class="bg-stone-50 border border-stone-200 rounded-lg p-6 sticky top-24">
            {%- comment -%} å•†å“å†…è¨³è¦‹å‡ºã— {%- endcomment -%}
            <div class="grid grid-cols-2 text-[11px] font-bold text-stone-400 uppercase tracking-widest mb-4 border-b border-stone-200 pb-2 gap-x-18">
              <span class="text-center text-xs">å•†å“å</span>
              <span class="text-center text-xs">ä¾¡æ ¼</span>
            </div>

            {%- comment -%} å•†å“å†…è¨³ãƒªã‚¹ãƒˆ {%- endcomment -%}
            <div class="space-y-3 mb-6">
              {% for item in cart.items %}
                <div class="flex justify-between items-start gap-4">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm text-stone-700 leading-snug">
                      {{ item.product.title }}
                      {% if item.quantity > 1 %}
                        <span class="text-stone-400 font-medium ml-1">x {{ item.quantity }}</span>
                      {% endif %}
                    </p>
                  </div>
                  <div class="flex-shrink-0 text-right">
                    <p class="text-sm font-medium text-stone-800">
                      {{ item.final_line_price | money }}
                    </p>
                  </div>
                </div>
              {% endfor %}
            </div>

            {%- comment -%} é‡‘é¡ã‚µãƒãƒªãƒ¼ {%- endcomment -%}

            <div class="space-y-3 mb-6">
              <div class="flex justify-between text-sm">
                <span class="text-stone-600">{{ section.settings.subtotal_label }}</span>
                <span class="text-stone-800 font-medium">{{ cart.total_price | money }}</span>
              </div>

              <div class="flex justify-between text-sm">
                <span class="text-stone-600">{{ section.settings.shipping_label }}</span>
                <span class="text-stone-500 text-xs">{{ section.settings.shipping_note }}</span>
              </div>

              <div class="pt-3 border-t border-stone-300">
                <div class="flex justify-between text-lg font-medium">
                  <span class="text-stone-800">{{ section.settings.total_label }}</span>
                  <span class="text-stone-800">{{ cart.total_price | money }}</span>
                </div>
              </div>
            </div>

            {%- comment -%} ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ {%- endcomment -%}
            <button
              type="submit"
              name="checkout"
              class="w-full bg-stone-800 text-white py-3 px-6 rounded hover:bg-stone-700 transition-colors font-medium"
            >
              {{ section.settings.checkout_button_text }}
            </button>

            <p class="text-xs text-stone-500 text-center mt-3">ç¨è¾¼ä¾¡æ ¼ã§è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™</p>
          </div>
        </div>
      </div>
    </form>

  {% else %}
    {%- comment -%} ã‚«ãƒ¼ãƒˆãŒç©ºã®å ´åˆ {%- endcomment -%}
    <div class="text-center py-16 md:py-24">
      <svg class="w-20 h-20 mx-auto text-stone-300 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
      </svg>

      <h2 class="text-2xl font-light text-stone-800 mb-3">
        {{ section.settings.empty_cart_message }}
      </h2>

      <a
        href="{{ routes.all_products_collection_url }}"
        class="inline-block mt-6 px-8 py-3 bg-stone-800 text-white rounded hover:bg-stone-700 transition-colors"
      >
        {{ section.settings.continue_shopping_text }}
      </a>
    </div>
  {% endif %}
</div>

{%- comment -%} JavaScript for Cart Updates {%- endcomment -%}
<script>
  function updateQuantity(key, quantity) {
    const formData = new FormData();
    formData.append('updates[' + key + ']', quantity);

    fetch('/cart/update.js', {
      method: 'POST',
      body: formData,
    })
      .then((response) => response.json())
      .then((data) => {
        window.location.reload();
      })
      .catch((error) => {
        console.error('Error:', error);
        alert('ã‚«ãƒ¼ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
      });
  }

  function toggleGiftMessage() {
    const checkbox = document.getElementById('gift-message-toggle');
    const input = document.getElementById('gift-message-input');

    if (checkbox.checked) {
      input.classList.remove('hidden');
    } else {
      input.classList.add('hidden');
      // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
      const textarea = input.querySelector('textarea');
      if (textarea) {
        textarea.value = '';
        document.getElementById('cart-form').submit();
      }
    }
  }
</script>

{% schema %}
{
  "name": "Cart",
  "settings": [
    {
      "type": "text",
      "id": "cart_title",
      "label": "ã‚«ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«",
      "default": "ã‚«ãƒ¼ãƒˆ"
    },
    {
      "type": "text",
      "id": "empty_cart_message",
      "label": "ç©ºã‚«ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸",
      "default": "ã‚«ãƒ¼ãƒˆã«å•†å“ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
    },
    {
      "type": "text",
      "id": "continue_shopping_text",
      "label": "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ç¶™ç¶šãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",
      "default": "ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚’ç¶šã‘ã‚‹"
    },
    {
      "type": "text",
      "id": "checkout_button_text",
      "label": "ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ",
      "default": "è³¼å…¥æ‰‹ç¶šãã¸"
    },
    {
      "type": "header",
      "content": "ã‚®ãƒ•ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³"
    },
    {
      "type": "text",
      "id": "gift_title",
      "label": "ã‚®ãƒ•ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒˆãƒ«",
      "default": "ã‚®ãƒ•ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³"
    },
    {
      "type": "text",
      "id": "gift_wrapping_label",
      "label": "ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ãƒ©ãƒ™ãƒ«",
      "default": "ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°ã‚’å¸Œæœ›ã™ã‚‹"
    },
    {
      "type": "text",
      "id": "gift_wrapping_note",
      "label": "ã‚®ãƒ•ãƒˆãƒ©ãƒƒãƒ”ãƒ³ã‚°æ³¨è¨˜",
      "default": "+ Â¥300"
    },
    {
      "type": "text",
      "id": "gift_message_label",
      "label": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ãƒ©ãƒ™ãƒ«",
      "default": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰ã‚’è¿½åŠ "
    },
    {
      "type": "text",
      "id": "gift_message_note",
      "label": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚«ãƒ¼ãƒ‰æ³¨è¨˜",
      "default": "ç„¡æ–™"
    },
    {
      "type": "text",
      "id": "gift_placeholder",
      "label": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼",
      "default": "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (100æ–‡å­—ä»¥å†…)"
    },
    {
      "type": "header",
      "content": "ã‚µãƒãƒªãƒ¼"
    },
    {
      "type": "text",
      "id": "subtotal_label",
      "label": "å°è¨ˆãƒ©ãƒ™ãƒ«",
      "default": "å°è¨ˆ"
    },
    {
      "type": "text",
      "id": "shipping_label",
      "label": "é…é€æ–™ãƒ©ãƒ™ãƒ«",
      "default": "é…é€æ–™"
    },
    {
      "type": "text",
      "id": "shipping_note",
      "label": "é…é€æ–™æ³¨è¨˜",
      "default": "è³¼å…¥æ‰‹ç¶šãæ™‚ã«è¨ˆç®—ã•ã‚Œã¾ã™"
    },
    {
      "type": "text",
      "id": "total_label",
      "label": "åˆè¨ˆãƒ©ãƒ™ãƒ«",
      "default": "åˆè¨ˆ"
    }
  ]
}
{% endschema %}
