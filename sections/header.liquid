<header
  x-data="
    {
      mobileMenuOpen: false,
      myMenuOpen: false
    }
  "
  class="sticky top-0 z-50 w-full font-serif"
>
  {% comment %} 1段目：ユーティリティバー（マイメニュー / 新規登録 / カート） {% endcomment %}
  <div class="bg-[{{ section.settings.top_bar_bg }}] text-sm py-2 border-b border-black/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
      <div class="flex items-center space-x-4">
        {% comment %} マイメニュー ドロップダウン {% endcomment %}
        <div class="relative">
          <button
            @click="myMenuOpen = !myMenuOpen"
            @click.away="myMenuOpen = false"
            class="flex items-center bg-white px-3 py-1 border border-gray-300 rounded text-gray-700 hover:bg-gray-50 transition"
          >
            <span>マイメニュー</span>
            <span class="ml-1 w-4 h-4 text-gray-400">
              {% render 'icon-chevron-down' %}
            </span>
          </button>
          <div
            x-show="myMenuOpen"
            x-cloak
            class="absolute left-0 mt-2 w-40 bg-white border border-gray-200 shadow-lg py-2 z-50"
          >
            <a href="/account" class="block px-4 py-2 hover:bg-gray-100">ログイン</a>
            <a href="/account" class="block px-4 py-2 hover:bg-gray-100">注文履歴</a>
          </div>
        </div>
        <a
          href="/account/register"
          class="bg-white px-3 py-1 border border-gray-300 rounded text-gray-700 hover:bg-gray-50 transition"
        >
          新規会員登録
        </a>
      </div>

      <div class="flex items-center">
        <a href="{{ routes.cart_url }}" class="relative text-gray-700 hover:opacity-70 transition">
          <div class="w-8 h-8">
            {% render 'icon-cart' %}
          </div>
          {% if cart.item_count > 0 %}
            <span class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-4 h-4 flex items-center justify-center">
              {{ cart.item_count }}
            </span>
          {% endif %}
        </a>
      </div>
    </div>
  </div>

  {% comment %} 2段目：ロゴ & 検索バー {% endcomment %}
  <div class="bg-[{{ section.settings.mid_bar_bg }}] py-4">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row items-center justify-between gap-4">
      {% comment %} ロゴエリア {% endcomment %}
      <div class="flex-shrink-0">
        <a href="/" class="block">
          {% if section.settings.logo != blank %}
            <img
              src="{{ section.settings.logo | image_url: width: 500 }}"
              alt="{{ section.settings.logo.alt | default: shop.name }}"
              style="width: {{ section.settings.logo_width }}px;"
              class="h-auto"
            >
          {% else %}
            <span class="text-3xl font-bold text-[#C2A992] tracking-widest italic">
              {{ section.settings.logo_text }}
            </span>
          {% endif %}
        </a>
      </div>

      {% comment %} 検索窓（中央配置） {% endcomment %}
      <div class="w-full max-w-md">
        <form
          action="{{ routes.search_url }}"
          method="get"
          class="relative flex items-center border border-gray-400 rounded overflow-hidden focus-within:ring-1 focus-within:ring-[#C2A992]"
        >
          <input
            type="text"
            name="q"
            placeholder="{{ section.settings.search_placeholder }}"
            class="w-full px-4 py-2 outline-none text-sm"
          >
          <button type="submit" class="bg-gray-400 p-2 text-white hover:bg-gray-500 transition">
            <div class="w-5 h-5">
              {% render 'icon-search' %}
            </div>
          </button>
        </form>
      </div>

      {% comment %} モバイル用ハンバーガー（中段に配置） {% endcomment %}
      <button
        @click="mobileMenuOpen = !mobileMenuOpen"
        type="button"
        class="lg:hidden absolute right-4 text-gray-600 p-2"
      >
        {% render 'icon-hambarger' %}
      </button>
    </div>
  </div>

  {% comment %} 3段目：ナビゲーションメニュー {% endcomment %}
  <nav class="hidden lg:block bg-[{{ section.settings.bot_bar_bg }}] border-t border-b border-black/5">
    <div class="max-w-7xl mx-auto px-4">
      <ul class="flex justify-center items-center space-x-10 py-3">
        {% for link in section.settings.main_linklist.links %}
          <li>
            <a
              href="{{ link.url }}"
              class="text-sm font-medium text-gray-700 hover:text-[#C2A992] transition duration-300"
            >
              {{ link.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </nav>

  {% comment %} モバイルメニュー（既存ロジックを継承） {% endcomment %}
  <div
    x-show="mobileMenuOpen"
    x-cloak
    class="lg:hidden bg-white border-t border-gray-100 shadow-xl"
  >
    <nav class="px-4 py-6 space-y-1">
      {% for link in section.settings.main_linklist.links %}
        <a href="{{ link.url }}" class="block py-3 text-lg text-gray-700 border-b border-gray-50 last:border-0">
          {{ link.title }}
        </a>
      {% endfor %}
    </nav>
  </div>
</header>

<style>
  [x-cloak] {
    display: none !important;
  }
</style>

{% schema %}
{
  "name": "Header Custom",
  "settings": [
    {
      "type": "header",
      "content": "ロゴ設定"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "ロゴ画像"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 300,
      "step": 5,
      "unit": "px",
      "label": "ロゴの横幅",
      "default": 120
    },
    {
      "type": "text",
      "id": "logo_text",
      "label": "ロゴテキスト（画像がない時）",
      "default": "Your day"
    },
    {
      "type": "header",
      "content": "ナビゲーション"
    },
    {
      "type": "link_list",
      "id": "main_linklist",
      "label": "表示するメニュー",
      "default": "main-menu"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "検索窓のプレースホルダー",
      "default": "商品番号・キーワード"
    },
    {
      "type": "header",
      "content": "カラー設定"
    },
    {
      "type": "color",
      "id": "top_bar_bg",
      "label": "上段背景色",
      "default": "#C2A992"
    },
    {
      "type": "color",
      "id": "mid_bar_bg",
      "label": "中段背景色",
      "default": "#FFFFFF"
    },
    {
      "type": "color",
      "id": "bot_bar_bg",
      "label": "下段背景色",
      "default": "#EAE1D8"
    }
  ]
}
{% endschema %}
