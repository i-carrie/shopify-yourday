<div class="matrix-variant-selector pt-1 mt-1">
  <div class="grid grid-cols-12 gap-2 pb-2 border-b border-gray-200 text-[11px] font-bold text-gray-400 uppercase tracking-wider">
    <div class="col-span-6">
      {% if product.has_only_default_variant %}商品名{% else %}{{ product.options.first }}{% endif %}
    </div>
    <div class="col-span-3 text-right">価格</div>
    <div class="col-span-3 text-center">個数</div>
  </div>

  <div class="space-y-0">
    {% for variant in product.variants %}
      <div
        class="grid grid-cols-12 gap-2 py-4 items-center border-b-2 border-gray-100 js-variant-row"
        data-variant-id="{{ variant.id }}"
      >
        <div class="col-span-6 flex flex-col pr-2">
          <span class="text-sm font-bold text-gray-800 leading-snug break-words">
            {% if product.has_only_default_variant %}
              {{ product.title }}
            {% else %}
              {{ variant.title }}
            {% endif %}
          </span>
          {% if variant.inventory_quantity <= 5 and variant.inventory_quantity > 0 %}
            <span class="text-[10px] text-red-500 font-bold mt-1"
              >残りわずか（{{ variant.inventory_quantity }}個）</span
            >
          {% endif %}
        </div>
        <div class="col-span-3 text-right">
          <span class="text-sm text-gray-700">{{ variant.price | money }}</span>
        </div>
        <div class="col-span-3 flex justify-center">
          <div style="position: relative; width: 64px;">
            <select
              name="updates[{{ variant.id }}]"
              class="js-matrix-quantity"
              style="width: 100%; padding: 6px 20px 6px 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #fff; color: #333; font-size: 14px; font-weight: bold; cursor: pointer; appearance: none; -webkit-appearance: none; text-align-last: center;"
            >
              {% for i in (0..10) %}
                <option value="{{ i }}">{{ i }}</option>
              {% endfor %}
            </select>
            <div style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #999; font-size: 8px;">
              ▼
            </div>
          </div>
        </div>
      </div>
    {% endfor %}

    {% assign related_set = product.metafields.custom.related_set.value %}
    {% if related_set != blank %}
      {% assign set_variant = related_set.first_available_variant %}
      <div
        class="grid grid-cols-12 gap-2 py-4 items-center border-b-2 border-gray-100 js-variant-row"
        data-variant-id="{{ set_variant.id }}"
      >
        <div class="col-span-6 flex flex-col pr-2">
          <span class="text-sm font-bold text-gray-900 leading-snug"> {{ related_set.title }} </span>
          <p class="text-[12px] text-gray-500 mt-1">{{ related_set.metafields.custom.product_subtitle }}</p>
        </div>
        <div class="col-span-3 text-right">
          <div class="flex flex-col">
            <span class="text-[14px] text-pink-700 line-through">{{ related_set.compare_at_price | money }}</span>
            <span class="text-sm text-gray-600">{{ related_set.price | money }}</span>
          </div>
        </div>
        <div class="col-span-3 flex justify-center">
          <div style="position: relative; width: 64px;">
            <select
              name="updates[{{ set_variant.id }}]"
              class="js-matrix-quantity"
              style="width: 100%; padding: 6px 20px 6px 8px; border: 1px solid #ccc; border-radius: 4px; background-color: #fff; color: #333; font-size: 14px; font-weight: bold; cursor: pointer; appearance: none; -webkit-appearance: none; text-align-last: center;"
            >
              {% for i in (0..10) %}
                <option value="{{ i }}">{{ i }}</option>
              {% endfor %}
            </select>
            <div style="position: absolute; right: 6px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #999; font-size: 8px;">
              ▼
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  {% comment %} ギフトオプション {% endcomment %}
  <div class="gift-options bg-pink-50 border border-pink-200 rounded-lg p-4 mt-6">
    <h3 class="text-sm font-bold text-gray-900 mb-3 flex items-center gap-2">
      {% render 'icon-gift' %}
      {{ section.settings.gift_title }}
    </h3>

    <div class="space-y-3">
      {% comment %} ギフトラッピング選択 {% endcomment %}
      <div class="flex items-start gap-3">
        <input
          type="checkbox"
          id="gift-wrapping"
          name="attributes[gift_wrapping]"
          value="yes"
          class="mt-1 w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"
        >
        <label for="gift-wrapping" class="flex-1 text-sm text-gray-700 cursor-pointer">
          <span class="font-semibold">{{ section.settings.gift_wrapping_label }}</span>
          <span class="block text-xs text-gray-500 mt-1">{{ section.settings.gift_wrapping_note }}</span>
        </label>
      </div>

      {% comment %} メッセージカード {% endcomment %}
      <div class="flex items-start gap-3">
        <input
          type="checkbox"
          id="message-card"
          name="attributes[message_card]"
          value="yes"
          class="mt-1 w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"
          onchange="document.getElementById('message-text-wrapper').classList.toggle('hidden')"
        >
        <label for="message-card" class="flex-1 text-sm text-gray-700 cursor-pointer">
          <span class="font-semibold">{{ section.settings.gift_message_label }}</span>
          <span class="block text-xs text-gray-500 mt-1">{{ section.settings.gift_message_note }}</span>
        </label>
      </div>

      {% comment %} メッセージ入力欄 {% endcomment %}
      <div id="message-text-wrapper" class="hidden">
        <textarea
          name="attributes[gift_message]"
          rows="3"
          maxlength="100"
          placeholder="{{ section.settings.gift_placeholder }}"
          class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-pink-500 resize-none"
        ></textarea>
        <p class="text-xs text-gray-500 mt-1">{{ section.settings.gift_warning_text }}</p>
      </div>
    </div>
  </div>

  <div class="mt-6">
    {% comment %} {% form 'product', product %} {% endcomment %}
    {% form 'product', product, id: 'product-form-{{ section.id }}' %}
      {% comment %} <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}"> {% endcomment %}

      <div class="grid grid-cols-2 gap-3 h-[45px] [&_*]:h-full [&_button]:min-h-0 [&_button]:m-0 [&_button]:rounded-none [&_button]:border-0 [&_button]:p-0">
        {% comment %}
          <button
            type="submit"
            name="add" id="add-to-cart-button"
            class="bg-black text-white font-bold text-[14px] md:text-sm uppercase tracking-widest flex items-center justify-center hover:bg-gray-800 transition"
          >
            カートに追加する
          </button>
        {% endcomment %}
        <button
          type="submit"
          name="add"
          id="add-to-cart-button"
          class="bg-black text-white font-bold text-[14px] md:text-sm uppercase tracking-widest flex items-center justify-center hover:bg-gray-800 transition"
        >
          カートに追加する
        </button>
        {{ form | payment_button }}
      </div>
    {% endform %}
  </div>
</div>
