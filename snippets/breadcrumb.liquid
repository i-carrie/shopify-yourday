<nav class="breadcrumb-bar bg-[#d7ebeb] py-2" aria-label="breadcrumb">
  <div class="max-w-6xl mx-auto px-4">
    <ol class="flex items-center gap-2 text-sm text-gray-700">
      {% comment %} ホーム {% endcomment %}
      <li class="flex items-center">
        <a href="/" class="flex items-center hover:text-gray-900 transition-colors duration-150">
          {% render 'icon-home' %}
        </a>
      </li>

      {% comment %} コレクションページ {% endcomment %}
      {% if template.name == 'collection' %}
        <li class="flex items-center gap-2">
          <span class="text-gray-400">&gt;</span>
          <span>{{ collection.title }}</span>
        </li>
      {% endif %}

      {% comment %} 商品ページ {% endcomment %}
      {% if template.name == 'product' %}
        {% comment %} URLパラメータからコレクションハンドルを取得 {% endcomment %}
        {% assign collection_param = '' %}
        {% comment %} {% assign url_parts = request.path | split: '?' %} {% endcomment %}

        {% comment %}
          {% if url_parts.size > 1 %}
            {% assign params = url_parts[1] | split: '&' %}
            {% for param in params %}
              {% if param contains 'collection=' %}
                {% assign collection_param = param | remove: 'collection=' %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endcomment %}

        {% if canonical_url contains '?' %}
          {% assign url_parts = canonical_url | split: '?' %}
          {% assign query_string = url_parts[1] %}
          {% assign params = query_string | split: '&' %}
          {% for param in params %}
            {% if param contains 'collection=' %}
              {% assign collection_param = param | split: '=' | last %}
            {% endif %}
          {% endfor %}
        {% endif %}

        {% comment %} vendorsコレクションかどうかを判定 {% endcomment %}
        {% assign is_vendors_collection = false %}
        {% if collection_param == 'vendors' %}
          {% assign is_vendors_collection = true %}
        {% endif %}

        {% comment %} ブランドページから来た場合は販売元名のみ表示 {% endcomment %}
        {% if is_vendors_collection %}
          <li class="flex items-center gap-2">
            <span class="text-gray-400">&gt;</span>
            <span>{{ product.vendor }}</span>
          </li>
        {% else %}
          {% comment %} 通常のコレクションページから来た場合 {% endcomment %}
          {% if collection_param != '' %}
            {% assign selected_collection = collections[collection_param] %}
            {% if selected_collection %}
              <li class="flex items-center gap-2">
                <span class="text-gray-400">&gt;</span>
                <a href="{{ selected_collection.url }}" class="hover:text-gray-900 transition-colors duration-150">
                  {{ selected_collection.title }}
                </a>
              </li>
            {% endif %}
          {% elsif product.collections.size > 0 %}
            <li class="flex items-center gap-2">
              <span class="text-gray-400">&gt;</span>
              <a href="{{ product.collections.first.url }}" class="hover:text-gray-900 transition-colors duration-150">
                {{ product.collections.first.title }}
              </a>
            </li>
          {% endif %}
          {% comment %} 商品名を表示 {% endcomment %}
          <li class="flex items-center gap-2">
            <span class="text-gray-400">&gt;</span>
            <span>{{ product.title }}</span>
          </li>
        {% endif %}
      {% endif %}

      {% comment %} 検索ページ {% endcomment %}
      {% if template.name == 'search' %}
        <li class="flex items-center gap-2">
          <span class="text-gray-400">&gt;</span>
          <span>検索結果</span>
        </li>
      {% endif %}

      {% comment %} カートページ {% endcomment %}
      {% if template.name == 'cart' %}
        <li class="flex items-center gap-2">
          <span class="text-gray-400">&gt;</span>
          <span>カート</span>
        </li>
      {% endif %}

      {% comment %} その他のページ {% endcomment %}
      {% if template.name == 'page' %}
        <li class="flex items-center gap-2">
          <span class="text-gray-400">&gt;</span>
          <span>{{ page.title }}</span>
        </li>
      {% endif %}
    </ol>
  </div>
</nav>
